<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Carpicker</title>
  <link rel="stylesheet" href="docs/index.css">
</head>
<body>
  <h1>Carpicker</h1>
  <!-- ==================== -->
  <p id="carpicker01">你还什么都没选</p>
  <!-- 品牌车系 -->
  <div class="athm-select" id="js-select-brand" data-toggle="carpicker" style="width: 400px">
    <div class="athm-select__selected" data-select-picker>
      <span class="athm-select__text" data-select-value>选择品牌/车系</span>
      <span class="athm-select__icon">
        <i class="athm-iconfont athm-iconfont-arrowdown"></i>
      </span>
    </div>
    <div class="athm-select__option" data-select-dropdown>
      <div class="pop-wrapper">
        <div class="brand" data-select-brand></div>
        <div class="series" data-select-series></div>
      </div>
    </div>
  </div>
  <br>
  <!-- 车型 -->
  <div class="athm-select disabled" id="js-select-spec" data-toggle="carpicker" style="width: 400px">
    <div class="athm-select__selected" data-select-picker>
      <span class="athm-select__text" data-select-value>选择车型(可不选)</span>
      <span class="athm-select__icon">
        <i class="athm-iconfont athm-iconfont-arrowdown"></i>
      </span>
    </div>
    <div class="athm-select__option" data-select-dropdown>
      <div class="pop-wrapper">
        <div class="spec" data-select-spec></div>
      </div>
    </div>
  </div>
  <br><br>
  <!-- ==================== -->
  <p id="carpicker02">你还什么都没选</p>
  <!-- 品牌车系车型 -->
  <div class="athm-select" id="js-select-simple" data-toggle="carpicker" style="width: 400px">
    <div class="athm-select__selected" data-select-picker>
      <span class="athm-select__text" data-select-value>选择品牌/车系/车型</span>
      <span class="athm-select__icon">
        <i class="athm-iconfont athm-iconfont-arrowdown"></i>
      </span>
    </div>
    <div class="athm-select__option" data-select-dropdown>
      <div class="pop-wrapper">
        <div class="brand" data-select-brand></div>
        <div class="series" data-select-series></div>
        <div class="spec" data-select-spec></div>
      </div>
    </div>
  </div>
  <br><br>
  <!-- ==================== -->
  <p id="carpicker03">你还什么都没选</p>
  <!-- 品牌 -->
  <div class="athm-select" id="js-select-brand2" data-toggle="carpicker" style="width: 400px">
    <div class="athm-select__selected" data-select-picker>
      <span class="athm-select__text" data-select-value>选择品牌</span>
      <span class="athm-select__icon">
        <i class="athm-iconfont athm-iconfont-arrowdown"></i>
      </span>
    </div>
    <div class="athm-select__option" data-select-dropdown>
      <div class="pop-wrapper">
        <div class="brand" data-select-brand></div>
      </div>
    </div>
  </div>
  <br>
  <!-- 车系 -->
  <div class="athm-select disabled" id="js-select-series2" data-toggle="carpicker" style="width: 400px">
    <div class="athm-select__selected" data-select-picker>
      <span class="athm-select__text" data-select-value>选择车系(可不选)</span>
      <span class="athm-select__icon">
        <i class="athm-iconfont athm-iconfont-arrowdown"></i>
      </span>
    </div>
    <div class="athm-select__option" data-select-dropdown>
      <div class="pop-wrapper">
        <div class="series" data-select-series></div>
      </div>
    </div>
  </div>
  <br>
  <!-- 车型 -->
  <div class="athm-select disabled" id="js-select-spec2" data-toggle="carpicker" style="width: 400px">
    <div class="athm-select__selected" data-select-picker>
      <span class="athm-select__text" data-select-value>选择车型(可不选)</span>
      <span class="athm-select__icon">
        <i class="athm-iconfont athm-iconfont-arrowdown"></i>
      </span>
    </div>
    <div class="athm-select__option" data-select-dropdown>
      <div class="pop-wrapper">
        <div class="spec" data-select-spec></div>
      </div>
    </div>
  </div>

  

  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  <script 
    src="http://car.autohome.com.cn/javascript/NewSpecCompare.js?20131010"
    charset="gb2312"></script>
  <script src="dist/carpicker.js"></script>
  <script>
    var dataCar = {
      getBrandData: function() {
        var carBrand = [];
        listCompare$100.forEach(element => {
          var item = {
            'id': element.I,
            'name': element.N,
            'letter': element.L,
            'list': element.List
          }
          carBrand.push(item)
        });
        return carBrand;
      },
      getSeriesData: function(key, callback) {
        var carSeries = [];
        listCompare$100.forEach(element => {
          if (element.I == key) {
            element.List.forEach(function (ele, i) {
              var item = {
                'id': '',
                'name': '',
                'list': [],
                'brandId': key
              };
              item.id = ele.I;
              item.name = ele.N; 
              ele.List.forEach(function (series, j) {
                item.list.push({
                  'id': series.I,
                  'name': series.N
                })
              })
              carSeries.push(item);
            })
            return;
          }
        });
        if (callback && typeof callback === 'function') {
          callback(carSeries)
        };
        return;
      },
      getSpecData: function(key, callback) {
        $.ajax({
          'url': 'http://car.autohome.com.cn/duibi/ashx/specComparehandler.ashx',
          'data': {'type': 1, 'seriesid': key, 'format': 'json'},
          'dataType': 'jsonp',
          'jsonp': 'callback'
        }).done(function(data) {
          var carSpec = [];
          if (data && data.List.length > 0) {
            data.List.forEach(function(ele, i) {
              var item = {
                'id': '',
                'name': '',
                'list': []
              };
              item.id = ele.I;
              item.name = ele.N; 
              ele.List.forEach(function(spec, j) {
                item.list.push({
                  'id': spec.I,
                  'name': spec.N,
                  'price': spec.P
                })
              })
              carSpec.push(item)
            })
            if (callback && typeof callback === 'function') {
              callback(carSpec);
            };
            return;
          }
        }).fail(function() {
          console.log('error');
        });
      }
    }

    // ===================

    $('#js-select-brand').carpicker({
      selectLevel: 'series',
      onInitPicker: dataCar.getBrandData,
      onBrandPicker: function (id) {
        dataCar.getSeriesData(id, function (data) {
          // 全部车系项
          var seriesItem = {
            'show': true,
            'link': true,
            'url': '//www.autohome.com.cn/'
          }
          $('#js-select-brand').data('fe.carpicker').setSeries(data, seriesItem);
        })
      },
      onSeriesPicker: function (id) {
        dataCar.getSpecData(id, function (data) {
          $('#js-select-spec').data('fe.carpicker').setSpec(data);
        });
      }
    })
    
    $('#js-select-brand').on('change.fe.carpicker', function (e, data, $item) {
      $('#carpicker01').text('你选择了：' + data.value + '-' + data.text);
      $('#js-select-spec').removeClass('disabled');
    });
    $('#js-select-spec').on('change.fe.carpicker', function (e, data, $item) {
      $('#carpicker01').text('你选择了：' + data.value + '-' + data.text);
    });

    // ==================

    $('#js-select-simple').carpicker({
      selectLevel: 'spec',
      selectNav: true,
      onInitPicker: dataCar.getBrandData,
      onBrandPicker: function (id) {
        dataCar.getSeriesData(id, function (data) {
          $('#js-select-simple').data('fe.carpicker').setSeries(data);
        })
      },
      onSeriesPicker: function (id) {
        dataCar.getSpecData(id, function (data) {
          $('#js-select-simple').data('fe.carpicker').setSpec(data);
        });
      }
    })
    $('#js-select-simple').on('change.fe.carpicker', function (e, data, $item) {
      $('#carpicker02').text('你选择了：' + data.value + '-' + data.text);
    });
    

    // ==================

    $('#js-select-brand2').carpicker({
      selectLevel: 'brand',
      onInitPicker: dataCar.getBrandData,
      onBrandPicker: function (id) {
        dataCar.getSeriesData(id, function (data) {
          $('#js-select-series2').data('fe.carpicker').setSeries(data);
        })
      }
    })
    $('#js-select-series2').carpicker({
      selectLevel: 'series',
      onSeriesPicker: function (id) {
        dataCar.getSpecData(id, function (data) {
          $('#js-select-spec2').data('fe.carpicker').setSpec(data);
        });
      }
    })
    
    $('#js-select-brand2').on('change.fe.carpicker', function (e, data, $item) {
      $('#carpicker03').text('你选择了：' + data.value + '-' + data.text);
      $('#js-select-series2').removeClass('disabled');
    });
    $('#js-select-series2').on('change.fe.carpicker', function (e, data, $item) {
      $('#carpicker03').text('你选择了：' + data.value + '-' + data.text);
      $('#js-select-spec2').removeClass('disabled');
    });
    $('#js-select-spec2').on('change.fe.carpicker', function (e, data, $item) {
      $('#carpicker03').text('你选择了：' + data.value + '-' + data.text);
    });


  </script>
</body>
</html>