/*!
 * @autofe/carpicker v0.1.0
 * (c) 2018 Autohome Inc.
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):(t.AutoFE=t.AutoFE||{},t.AutoFE.Carpicker=e(t.jQuery))}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e="carpicker",i="fe.carpicker",s="."+i,a=t.fn[e],n={INIT:"init"+s,SHOW:"show"+s,SHOWN:"shown"+s,HIDE:"hide"+s,HIDDEN:"hidden"+s,CHANGE:"change"+s,CLICK:"click"+s,CLICK_DISMISS:"click.dismiss"+s,CLICK_DATA_API:"click"+s+".data-api"},r='[data-toggle="carpicker"]',o="[data-value]",l="data-text",d="data-value";function c(e,i){this.options=t.extend({},c.Default,i),this.$elem=t(e),this.$picker=t(this.options.selectPicker,this.$elem),this.$value=t(this.options.selectValue,this.$elem),this.$dropdown=t(this.options.selectDropdown,this.$elem),this.$brand=t(this.options.selectBrand,this.$elem),this.$series=t(this.options.selectSeries,this.$elem),this.$spec=t(this.options.selectSpec,this.$elem),this.$level=this.options.selectLevel,this.isActive=!1,this._data=null,this._brandData=null,this._init()}function p(e){return this.each(function(){var s=t(this),a=s.data(i),n=t.extend({},c.Default,s.data(),"object"==typeof e&&e);if(a||(a=new c(this,n),s.data(i,a)),"string"==typeof e){if("undefined"==typeof a[e])throw new TypeError('No method named "'+e+'"');a[e]()}})}return c.Default={selectPicker:"[data-select-picker]",selectValue:"[data-select-value]",selectDropdown:"[data-select-dropdown]",selectBrand:"[data-select-brand]",selectSeries:"[data-select-series]",selectSpec:"[data-select-spec]",selectedClass:"selected",disabledClass:"disabled",activeClass:"active",selectNav:!1,selectLevel:"brand",onInitPicker:null,onBrandPicker:null,onSeriesPicker:null,onSpecPicker:null},c.prototype._init=function(){var e=this;e.$elem.trigger(n.INIT,e),e.$picker.on(n.CLICK,t.proxy(e.toggle,e)),e.options.selectNav&&(0==e.$brand.prev("ul.pop-nav").length&&e.$brand.parent().prepend('<ul class="pop-nav"></ul>'),e.$dropdown.on(n.CLICK,"em",function(){switch(t(this).parent().index()){case 0:e.$brand.show(),e.$series.hide(),e.$spec.hide(),e.$brand.prev(".pop-nav").html("<li><em>品牌</em></li>");break;case 1:e.$brand.hide(),e.$series.show(),e.$spec.hide(),e.$brand.prev(".pop-nav").html("<li><em>品牌</em></li>\n          <li><span>&gt;</span><em>车系</em></li>")}return!1})),e.$dropdown.on(n.CLICK,o,function(){var i=t(this),s=i.attr("data-target");"brand"===s&&"function"==typeof e.options.onBrandPicker&&e.options.onBrandPicker(i.attr(d)),"series"===s&&"function"==typeof e.options.onSeriesPicker&&e.options.onSeriesPicker(i.attr(d)),"spec"===s&&"function"==typeof e.options.onSpecPicker&&e.options.onSpecPicker(i.attr(d)),"brand"===s&&"brand"==e.options.selectLevel&&(e.setValue({text:i.attr(l),value:i.attr(d)}),e.hide()),"series"!==s||"series"!=e.options.selectLevel&&("spec"!=e.options.selectLevel||e.options.selectNav)||(e.setValue({text:i.attr(l),value:i.attr(d)}),e.hide()),"spec"===s&&(e.setValue({text:i.attr(l),value:i.attr(d)}),e.hide())}),t(document).on(n.CLICK_DISMISS,function(i){0===t(i.target).closest(e.$elem).length&&e.isActive&&e.hide()}),"function"==typeof e.options.onInitPicker&&(e._brandData=e.options.onInitPicker(),e.setBrand())},c.prototype.setValue=function(t){var e=this.options.selectedClass;if((this.getValue()||{}).value!==t.value){var i=this.$dropdown.find(o),s=this.$dropdown.find('[data-value="'+String(t.value)+'"]');i.removeClass(e),s.addClass(e),this.$value.text(t.text),this._data={text:t.text,value:t.value},this.$elem.trigger(n.CHANGE,[t,s])}},c.prototype.getValue=function(){return this._data},c.prototype.toggle=function(){this.isActive?this.hide():this.show()},c.prototype.show=function(){var e=this.options.activeClass,i=this.options.disabledClass;if(!this.$elem.hasClass(i)){var s=t.Event(n.SHOW);this.$elem.trigger(s,this),s.isDefaultPrevented()||(this.isActive=!0,this.$elem.addClass(e),this.$dropdown.show(),this.$elem.trigger(n.SHOWN,this))}},c.prototype.hide=function(){var e=this.options.activeClass,i=t.Event(n.HIDE);this.$elem.trigger(i,this),i.isDefaultPrevented()||(this.isActive=!1,this.$elem.removeClass(e),this.$dropdown.hide(),this.$elem.trigger(n.HIDDEN,this))},c.prototype.disable=function(){var t=this.options.disabledClass;this.$elem.addClass(t)},c.prototype.enable=function(){var t=this.options.disabledClass;this.$elem.removeClass(t)},c.prototype.setBrand=function(){var e=this;e.options.selectNav&&e.$brand.prev(".pop-nav").html("<li><em>品牌</em></li>");var i=[];if(e._brandData.forEach(function(t){i.includes(t.letter)||i.push(t.letter)}),""===t.trim(e.$brand.html())){for(var s='<ol class="index">',a='<dl class="list">',n=0;n<i.length;n++)s+="<li data-target='jump-"+String(i[n])+"'>"+String(i[n])+"</li>",a+="<dt id='jump-"+String(i[n])+"'>"+String(i[n])+"</dt>",e._brandData.forEach(function(t){t.letter==i[n]&&(a+='<dd data-value="'+String(t.id)+'" data-text="'+String(t.name)+'" data-target="brand">'+String(t.name)+"</dd>")});s+="</ol>",a+="</dl>",e.$brand.html(s+a),e.setIndexLoca()}e.$brand.show()},c.prototype.setSeries=function(t,e){var i=this;if(t.length>0){i.options.selectNav&&(i.$brand.prev(".pop-nav").html("<li><em>品牌</em></li>\n      <li><span>&gt;</span><em>车系</em></li>"),i.$brand.hide()),i.$series.show();var s='<dl class="list">';return t.forEach(function(t,i){e&&e.show&&0==i&&(e.link?s+='<dd><a class="all" href="'+String(e.url)+String(t.brandId)+'" target="_blank">全部车系</a></dd>':s+='<dd data-value="'+String(t.brandId)+'" data-text="全部车系" data-target="series">全部车系</dd>'),s+="<dt>"+String(t.name)+"</dt>",t.list.forEach(function(t){s+='<dd data-value="'+String(t.id)+'" data-text="'+String(t.name)+'" data-target="series">'+String(t.name)+"</dd>"})}),s+="</dl>",void i.$series.html(s)}},c.prototype.setSpec=function(t){var e=this;e.options.selectNav&&(e.$brand.prev(".pop-nav").html("<li><em>品牌</em></li>\n    <li><span>&gt;</span><em>车系</em></li>\n    <li><span>&gt;</span><em>车型</em></li>"),e.$brand.hide(),e.$series.hide()),e.$spec.show();var i='<dl class="list">';t.length>0?(t.forEach(function(t){i+="<dt>"+String(t.name)+"</dt>",t.list.forEach(function(t){i+='<dd data-value="'+String(t.id)+'" data-text="'+String(t.name)+'" data-target="spec">'+String(t.name)+"<span>"+(t.price>0?(t.price/1e4).toFixed(2)+"万":"暂无")+"</span></dd>"})}),i+="<dd></dd>"):i+="<dd>暂无相关车型</dd>",i+="</dl>",e.$spec.html(i)},c.prototype.setIndexLoca=function(){var e=this;e.$brand.on(n.CLICK,'li[data-target^="jump"]',function(){t(".list",e.$brand).scrollTop(0),t(this).addClass("active").siblings().removeClass("active");var i=t(this).attr("data-target"),s=t("dt#"+i,e.$brand).position("list").top;t(".list",e.$brand).scrollTop(s)})},t(function(){p.call(t(r))}),t.fn[e]=p,t.fn[e].Constructor=c,t.fn[e].noConflict=function(){return t.fn[e]=a,p},c});